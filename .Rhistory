WX$hhid <- rownames(WX)
View(WX)
# Dist-wt migration
WX <- as.data.frame(W %*% X)
# Clean
WX <- WX %>%
mutate(hhid = rownames())
WX <- WX %>%
mutate(hhid = rownames(WX))
View(WX)
WX <- as.data.frame(W %*% X)
View(WX)
View(portfolio_list)
WX1 <- WX %>%
mutate(hhid = str_remove(rownames(WX), 'X'))
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*"))
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2)
View(WX1)
View(ihds)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
left_join(ihds[,c('hhid, hh_code')], by='hhid')
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
left_join(ihds[,c('hhid', 'hh_code')], by='hhid')
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2)
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2)
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
left_join(ihds, by='hhid')
View(WX1)
WX <- as.data.frame(W %*% X)
View(WX)
View(ihds_crop)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2)
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct()
View(ihds)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds, by='hhid')
View(WX1)
View(portfolio)
View(portfolio)
ihds <- read_csv(paste(PANEL, 'ihds_migration_ag_panel.csv', sep='')) %>%
select(wave, hh_code, stateid, distid, psuid, hhid, hhsplitid, nr_wa_m) %>%
pivot_wider(names_from = wave,
values_from = c(hhid, hhsplitid, nr_wa_m))
View(ihds)
# Read IHDS
ihds <- read_csv(paste(PANEL, 'ihds_migration_ag_panel.csv', sep='')) %>%
select(wave, hh_code, stateid, distid, psuid, hhid, hhsplitid, nr_wa_m) %>%
pivot_wider(names_from = wave,
values_from = c(hhid, hhsplitid, nr_wa_m)) %>%
mutate(hhid = paste(sprintf("%03d", stateid), sprintf("%03d", distid),
sprintf("%03d", psuid), sprintf("%03d", hhid_wave1),
sprintf("%03d", hhsplitid_wave1), sep=''))
# Merge crop portfolios
ihds_crop <- merge(ihds, portfolio, by='hhid')
View(ihds_crop)
#------------------------------------------
# PROJECT: RUM
# PURPOSE: Crop Distance Wt Migration
# AUTHOR: Raahil Madhok
#------------------------------------------
# Directories
rm(list=ls())
CROP <- '/Volumes/Backup Plus/research/rum/data/crop_dist/'
PANEL <- '/Users/rmadhok/Dropbox/rum_india/data/csv/'
# Load Packages
require(tidyverse)
require(spatialreg)
require(spdep)
#------------------------------------------
# CROP PORTFOLIOS
#------------------------------------------
# Read
crops <- read_csv(paste(PANEL, '22626-0008-Data.csv', sep='')) %>%
rename(area = FM14,
qty = FM15,
price = FM18,
crop=FM12) %>%
mutate(hhid = paste(sprintf("%03d", STATEID), sprintf("%03d", DISTID),
sprintf("%03d", PSUID), sprintf("%03d", HHID),
sprintf("%03d", HHSPLITID), sep='')) %>%
select(-c(STATEID, DISTID, PSUID, HHID, HHSPLITID))
names(crops) <- tolower(names(crops))
# Crop Shares
crop_share <- crops %>%
mutate(qty = replace(qty, fm15x == 'Yes', NA),
price = as.numeric(price),
value = qty * (price/10)) %>%
group_by(hhid, crop) %>% # aggregate crop over seasons
summarize(value = sum(value, na.rm=T)) %>%
group_by(hhid) %>%
mutate(value_hh = sum(value, na.rm=T),
value_share = value/value_hh) %>%
select(hhid, crop, value_share)
# Complete crop portfolio
portfolio <- crop_share %>%
ungroup() %>%
complete(hhid, crop, fill = list(value_share = 0)) %>%
group_by(hhid) %>%
summarize(portfolio = list(value_share))
# Household portfolio lists
#portfolio <- split(crop_full$value_share,crop_full$hhid)
#------------------------------------------
# MERGE TO IHDS
#------------------------------------------
# Read IHDS
ihds <- read_csv(paste(PANEL, 'ihds_migration_ag_panel.csv', sep='')) %>%
select(wave, hh_code, stateid, distid, psuid, hhid, hhsplitid, nr_wa_m) %>%
pivot_wider(names_from = wave,
values_from = c(hhid, hhsplitid, nr_wa_m)) %>%
mutate(hhid = paste(sprintf("%03d", stateid), sprintf("%03d", distid),
sprintf("%03d", psuid), sprintf("%03d", hhid_wave1),
sprintf("%03d", hhsplitid_wave1), sep=''))
# Merge crop portfolios
ihds_crop <- merge(ihds, portfolio, by='hhid')
#---------------------------------------------
# DISTANCE MATRIX
#---------------------------------------------
# Portfolio list
portfolio_list <- ihds_crop$portfolio
names(portfolio_list) <- ihds_crop$hhid
# Euclidean distance
euc.dist <- function(x1, x2) {
sqrt(sum((x1 - x2) ^ 2))
}
# Empty weight matrix
W <- matrix(nrow=length(portfolio_list), ncol=length(portfolio_list))
rownames(W) <- names(portfolio_list)
colnames(W) <- names(portfolio_list)
W <- readRDS(paste(CROP, 'crop_dist.rds', sep=''))
X <- as.matrix(ihds_crop[,c('nr_wa_m_wave1', 'nr_wa_m_wave2')])
WX <- as.data.frame(W %*% X)
View(WX)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct()
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds[,c('hh_code', 'hhid')], by='hhid')
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds[,c('hh_code', 'hhid')], by='hhid') %>%
select(-hhid)
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds[,c('hh_code', 'hhid')], by='hhid') %>%
select(-hhid) %>%
pivot_longer(cols=starts_with('nr'),
names_to='wave',
values_to='nr_crop_wt')
View(WX1)
WX1 <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds[,c('hh_code', 'hhid')], by='hhid') %>%
select(-hhid) %>%
pivot_longer(cols=starts_with('nr'),
names_to='wave',
values_to='nr_crop_wt',
names_prefix='nr_crop_wt_')
View(WX1)
View(WX)
# Clean
WX <- WX %>%
mutate(hhid = str_remove(str_remove(rownames(WX), 'X'),"\\..*")) %>%
rename(nr_crop_wt_wave1 = nr_wa_m_wave1,
nr_crop_wt_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds[,c('hh_code', 'hhid')], by='hhid') %>%
select(-hhid) %>%
pivot_longer(cols=starts_with('nr'),
names_to='wave',
values_to='nr_crop_wt',
names_prefix='nr_crop_wt_')
write_csv(WX, paste(PANEL, 'crop_wt_dist.csv', sep=''))
# Read from compute canada output
W <- readRDS(paste(CROP, 'crop_dist.rds', sep=''))
#------------------------------------------
# PROJECT: RUM
# PURPOSE: Crop Distance Wt Migration
# AUTHOR: Raahil Madhok
#------------------------------------------
# Directories
rm(list=ls())
CROP <- '/Volumes/Backup Plus/research/rum/data/crop_dist/'
PANEL <- '/Users/rmadhok/Dropbox/rum_india/data/csv/'
# Load Packages
require(tidyverse)
require(spatialreg)
require(spdep)
#------------------------------------------
# CROP PORTFOLIOS
#------------------------------------------
# Read
crops <- read_csv(paste(PANEL, '22626-0008-Data.csv', sep='')) %>%
rename(area = FM14,
qty = FM15,
price = FM18,
crop=FM12) %>%
mutate(hhid = paste(sprintf("%03d", STATEID), sprintf("%03d", DISTID),
sprintf("%03d", PSUID), sprintf("%03d", HHID),
sprintf("%03d", HHSPLITID), sep='')) %>%
select(-c(STATEID, DISTID, PSUID, HHID, HHSPLITID))
names(crops) <- tolower(names(crops))
# Crop Shares
crop_share <- crops %>%
mutate(qty = replace(qty, fm15x == 'Yes', NA),
price = as.numeric(price),
value = qty * (price/10)) %>%
group_by(hhid, crop) %>% # aggregate crop over seasons
summarize(value = sum(value, na.rm=T)) %>%
group_by(hhid) %>%
mutate(value_hh = sum(value, na.rm=T),
value_share = value/value_hh) %>%
select(hhid, crop, value_share)
# Complete crop portfolio
portfolio <- crop_share %>%
ungroup() %>%
complete(hhid, crop, fill = list(value_share = 0)) %>%
group_by(hhid) %>%
summarize(portfolio = list(value_share))
#------------------------------------------
# MERGE TO IHDS
#------------------------------------------
# Read IHDS
ihds <- read_csv(paste(PANEL, 'ihds_migration_ag_panel.csv', sep='')) %>%
select(wave, hh_code, stateid, distid, psuid, hhid, hhsplitid, nr_wa_m) %>%
pivot_wider(names_from = wave,
values_from = c(hhid, hhsplitid, nr_wa_m)) %>%
mutate(hhid = paste(sprintf("%03d", stateid), sprintf("%03d", distid),
sprintf("%03d", psuid), sprintf("%03d", hhid_wave1),
sprintf("%03d", hhsplitid_wave1), sep=''))
# Merge crop portfolios
ihds_crop <- merge(ihds, portfolio, by='hhid')
#---------------------------------------------------
# ALL INDIA: Other-district crop-weighted migration
#---------------------------------------------------
# Portfolio list
portfolio_list <- ihds_crop$portfolio
names(portfolio_list) <- ihds_crop$hhid
# Euclidean distance
euc.dist <- function(x1, x2) {
sqrt(sum((x1 - x2) ^ 2))
}
# Empty weight matrix
W_nat <- matrix(nrow=length(portfolio_list), ncol=length(portfolio_list))
rownames(W_nat) <- names(portfolio_list)
colnames(W_nat) <- names(portfolio_list)
W_st <- matrix(nrow=length(portfolio_list), ncol=length(portfolio_list))
rownames(W_st) <- names(portfolio_list)
colnames(W_st) <- names(portfolio_list)
substr(rownames(W_st)[1], 1,3)
substr(rownames(W_st)[100], 1,3)
substr(rownames(W_st)[1000], 1,3)
View(W_st[1:100,1:10])
substr(rownames(W_st)[8], 1,3)
substr(rownames(W_st)[9], 1,3)
W_nat <- readRDS(paste(CROP, 'crop_dist_nat.rds', sep=''))
# Migration matrix
X <- as.matrix(ihds_crop[,c('nr_wa_m_wave1', 'nr_wa_m_wave2')])
# Dist-wt migration
W_natX <- as.data.frame(W_nat %*% X)
# Clean
W_natX <- W_natX %>%
mutate(hhid = str_remove(str_remove(rownames(W_natX), 'X'),"\\..*")) %>%
rename(nr_wt_nat_wave1 = nr_wa_m_wave1,
nr_wt_nat_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds[,c('hh_code', 'hhid')], by='hhid') %>%
select(-hhid) %>%
pivot_longer(cols=starts_with('nr'),
names_to='wave',
values_to='nr_wt_nat',
names_prefix='nr_wt_nat_')
View(W_natX)
W_st <- readRDS(paste(CROP, 'crop_dist_st.rds', sep=''))
# Dist-wt migration
W_stX <- as.data.frame(W_st %*% X)
# Clean
W_stX <- W_stX %>%
mutate(hhid = str_remove(str_remove(rownames(W_stX), 'X'),"\\..*")) %>%
rename(nr_wt_st_wave1 = nr_wa_m_wave1,
nr_wt_st_wave2 = nr_wa_m_wave2) %>%
distinct() %>% # b/c some hh duplicate round 1 values bc split up in round 2
left_join(ihds[,c('hh_code', 'hhid')], by='hhid') %>%
select(-hhid) %>%
pivot_longer(cols=starts_with('nr'),
names_to='wave',
values_to='nr_wt_st',
names_prefix='nr_wt_st_')
View(W_stX)
View(W_natX)
# Merge
WX <- merge(W_natX, W_stX, by=c('hhid', 'wave'))
View(W_stX)
View(W_stX)
WX <- merge(W_natX, W_stX, by=c('hh_code', 'wave'))
View(WX)
WX <- merge(W_natX, W_stX, by=c('hh_code', 'wave')) %>%
arrange(hh_code)
View(WX)
View(W_stX)
write_csv(WX, paste(PANEL, 'crop_wt_dist.csv', sep=''))
#------------------------------------------
# PROJECT: RUM
# PURPOSE: Crop Distance Wt Migration
# AUTHOR: Raahil Madhok
#------------------------------------------
# Directories
rm(list=ls())
CROP <- '/Volumes/Backup Plus/research/rum/data/crop_dist/'
PANEL <- '/Users/rmadhok/Dropbox/rum_india/data/csv/'
# Load Packages
require(tidyverse)
require(spatialreg)
require(spdep)
#------------------------------------------
# CROP PORTFOLIOS
#------------------------------------------
# Read
crops <- read_csv(paste(PANEL, '22626-0008-Data.csv', sep='')) %>%
rename(area = FM14,
qty = FM15,
price = FM18,
crop=FM12) %>%
mutate(hhid = paste(sprintf("%03d", STATEID), sprintf("%03d", DISTID),
sprintf("%03d", PSUID), sprintf("%03d", HHID),
sprintf("%03d", HHSPLITID), sep='')) %>%
select(-c(STATEID, DISTID, PSUID, HHID, HHSPLITID))
names(crops) <- tolower(names(crops))
# Crop Shares
crop_share <- crops %>%
mutate(qty = replace(qty, fm15x == 'Yes', NA),
price = as.numeric(price),
value = qty * (price/10)) %>%
group_by(hhid, crop) %>% # aggregate crop over seasons
summarize(value = sum(value, na.rm=T)) %>%
group_by(hhid) %>%
mutate(value_hh = sum(value, na.rm=T),
value_share = value/value_hh) %>%
select(hhid, crop, value_share)
# Complete crop portfolio
portfolio <- crop_share %>%
ungroup() %>%
complete(hhid, crop, fill = list(value_share = 0)) %>%
group_by(hhid) %>%
summarize(portfolio = list(value_share))
#------------------------------------------
# MERGE TO IHDS
#------------------------------------------
# Read IHDS
ihds <- read_csv(paste(PANEL, 'ihds_migration_ag_panel.csv', sep='')) %>%
select(wave, hh_code, stateid, distid, psuid, hhid, hhsplitid, nr_wa_m) %>%
pivot_wider(names_from = wave,
values_from = c(hhid, hhsplitid, nr_wa_m)) %>%
mutate(hhid = paste(sprintf("%03d", stateid), sprintf("%03d", distid),
sprintf("%03d", psuid), sprintf("%03d", hhid_wave1),
sprintf("%03d", hhsplitid_wave1), sep=''))
# Merge crop portfolios
ihds_crop <- merge(ihds, portfolio, by='hhid')
#---------------------------------------------------
# ALL INDIA: Other-district crop-weighted migration
#---------------------------------------------------
# Portfolio list
portfolio_list <- ihds_crop$portfolio
names(portfolio_list) <- ihds_crop$hhid
# Euclidean distance
euc.dist <- function(x1, x2) {
sqrt(sum((x1 - x2) ^ 2))
}
X <- as.matrix(ihds_crop[,c('nr_wa_m_wave1', 'nr_wa_m_wave2')])
W_st <- readRDS(paste(CROP, 'crop_dist_st.rds', sep=''))
W_nat <- readRDS(paste(CROP, 'crop_dist_nat.rds', sep=''))
W_st[1,1000]
W_nat[1,1000]
W_nat[1,10]
W_st[1,10]
W_st[1,100]
W_nat[1,100]
W_nat[1,10000]
W_st[1,10000]
# PROJECT: Wildlife and Lockdon
# PURPOSE: Paper Figures/tables
# AUTHOR: Raahil Madhok
# DATE: June 24 2020 [created]
# Settings
rm(list=ls())
require(tidyverse)
require(sf)
require(kableExtra)
require(modelsummary)
require(stargazer)
require(starpolishr)
require(estimatr)
require(cowplot)
require(fastDummies)
require(data.table)
source('/Users/rmadhok/Dropbox/ebird_lockdown/scripts/R/select_functions.R')
setwd('/Users/rmadhok/Dropbox/ebird_lockdown/')
#-----------------------------------------------
# FIG 1 : Daily Activity
#-----------------------------------------------
# Read data (2018-2020)
ebird_full <- readRDS('./data/final/ebd_full.rds')
estimates <- data.frame()
# Top 20, 2 Trips
sample <- did(ebird_full, num_cities=20)
# PROJECT: Wildlife and Lockdon
# PURPOSE: Paper Figures/tables
# AUTHOR: Raahil Madhok
# DATE: June 24 2020 [created]
# Settings
rm(list=ls())
require(tidyverse)
require(sf)
require(kableExtra)
require(modelsummary)
require(stargazer)
require(starpolishr)
require(estimatr)
require(cowplot)
require(fastDummies)
require(data.table)
source('/Users/rmadhok/Dropbox/ebird_lockdown/scripts/R/select_functions.R')
setwd('/Users/rmadhok/Dropbox/ebird_lockdown/')
#-----------------------------------------------
# FIG 1 : Daily Activity
#-----------------------------------------------
# Read data (2018-2020)
ebird_full <- readRDS('./data/final/ebd_full.rds')
ebird_full <- filter(ebird_full, year == 2019 | year == 2020)
# PROJECT: Wildlife and Lockdon
# PURPOSE: Paper Figures/tables
# AUTHOR: Raahil Madhok
# DATE: June 24 2020 [created]
# Settings
rm(list=ls())
require(tidyverse)
require(sf)
require(kableExtra)
require(modelsummary)
require(stargazer)
require(starpolishr)
require(estimatr)
require(cowplot)
require(fastDummies)
require(data.table)
source('/Users/rmadhok/Dropbox/ebird_lockdown/scripts/R/select_functions.R')
setwd('/Users/rmadhok/Dropbox/ebird_lockdown/')
#-----------------------------------------------
# FIG 1 : Daily Activity
#-----------------------------------------------
# Read data (2018-2020)
ebird_full <- readRDS('./data/final/ebd_full.rds') # Full
sample_2019 <- filter(ebird_full, year == 2019 & date <= '2019-04-20' & date >= '2019-03-03')
sample_2019 <- select_sample(sample_2019, num_cities=20, lockdown='2019-03-26')
sample_2020 <- filter(ebird_full, year == 2020 & date <= '2020-04-17')
sample_2020 <- select_sample(sample_20, num_cities=20, lockdown='2020-03-24')
sample_2020 <- select_sample(sample_2020, num_cities=20, lockdown='2020-03-24')
View(sample_2019)
View(sample_2020)
